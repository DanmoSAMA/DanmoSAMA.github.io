<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>SQL Murder Mystery | DanmoSAMAの博客</title><meta name="keywords" content="js,hrbrid"><meta name="author" content="Danmoits"><meta name="copyright" content="Danmoits"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SQL Murder Mystery">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL Murder Mystery">
<meta property="og:url" content="https://danmosama.github.io/2022/10/13/sql/index.html">
<meta property="og:site_name" content="DanmoSAMAの博客">
<meta property="og:description" content="SQL Murder Mystery">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://z3.ax1x.com/2021/08/17/fIut8s.png">
<meta property="article:published_time" content="2022-10-13T01:04:20.446Z">
<meta property="article:modified_time" content="2022-10-13T01:05:09.892Z">
<meta property="article:author" content="Danmoits">
<meta property="article:tag" content="js">
<meta property="article:tag" content="hrbrid">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://z3.ax1x.com/2021/08/17/fIut8s.png"><link rel="shortcut icon" href="/img/avatar.jpg"><link rel="canonical" href="https://danmosama.github.io/2022/10/13/sql/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SQL Murder Mystery',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-13 09:05:09'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "https://z3.ax1x.com/2021/08/18/fIcAZ6.gif" data-lazy-src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fa fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://z3.ax1x.com/2021/08/17/fIut8s.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">DanmoSAMAの博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fa fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SQL Murder Mystery</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-13T01:04:20.446Z" title="发表于 2022-10-13 09:04:20">2022-10-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-10-13T01:05:09.892Z" title="更新于 2022-10-13 09:05:09">2022-10-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/hybrid/">hybrid</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><a target="_blank" rel="noopener" href="https://mystery.knightlab.com/">SQL Murder Mystery</a></p>
<h1 id="Select-Star-Sql"><a href="#Select-Star-Sql" class="headerlink" title="Select Star Sql"></a>Select Star Sql</h1><h2 id="Beazley’s-Last-Statement"><a href="#Beazley’s-Last-Statement" class="headerlink" title="Beazley’s Last Statement"></a>Beazley’s Last Statement</h2><p>查找此人的遗言：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name, last_name, last_statement</span><br><span class="line"><span class="keyword">FROM</span> executions</span><br><span class="line"><span class="keyword">WHERE</span> first_name <span class="keyword">LIKE</span> <span class="string">&#x27;_apoleon&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;%ley&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Claims-of-Innocence"><a href="#Claims-of-Innocence" class="headerlink" title="Claims of Innocence"></a>Claims of Innocence</h2><p>查找所有拒绝遗言的人：（第二种写法可以查询符合该条件的数量，但需要遍历全表）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- WHERE --</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> executions</span><br><span class="line"><span class="keyword">WHERE</span> last_statement <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- COUNT CASE WHEN --</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> last_statement <span class="keyword">IS</span> <span class="keyword">NULL</span> <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">     <span class="keyword">ELSE</span> <span class="keyword">NULL</span> <span class="keyword">END</span>)</span><br><span class="line"><span class="keyword">FROM</span> executions</span><br><span class="line"></span><br><span class="line"><span class="comment">-- COUNT functions --</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">-</span> <span class="built_in">COUNT</span>(last_statement) <span class="keyword">FROM</span> executions</span><br></pre></td></tr></table></figure>

<p>平均遗言长度：<strong>LENGTH</strong> 统计字符串长度</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(LENGTH(last_statement))</span><br><span class="line"><span class="keyword">FROM</span> executions</span><br></pre></td></tr></table></figure>

<hr>
<p>去重：DISTINCT</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> county</span><br><span class="line"><span class="keyword">FROM</span> executions</span><br></pre></td></tr></table></figure>

<p>也可以用 GROUP BY：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> county</span><br><span class="line"><span class="keyword">FROM</span> executions</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> county</span><br></pre></td></tr></table></figure>

<hr>
<p>查询喊冤的人数比：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="number">1.0</span> <span class="operator">*</span> <span class="built_in">COUNT</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> last_statement <span class="keyword">LIKE</span> <span class="string">&#x27;%innocent%&#x27;</span></span><br><span class="line">    <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="keyword">NULL</span> <span class="keyword">END</span>) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> executions</span><br></pre></td></tr></table></figure>

<h2 id="The-long-tail"><a href="#The-long-tail" class="headerlink" title="The long tail"></a>The long tail</h2><h3 id="Strange-Query"><a href="#Strange-Query" class="headerlink" title="Strange Query"></a>Strange Query</h3><p>如果查找的其中一列是聚合，<strong>另一列既不是聚合，又不是 GROUP BY 的列</strong>，这种现象称作“Strange Query”。比如第一列是 Count，第二列是 first_name，那么查询得到的表格中，first_name 列对应最后一个表项的值。</p>
<blockquote>
<p>In this case, our database picks the first name <strong>from the last entry in our table.</strong></p>
</blockquote>
<hr>
<p>WHERE 在聚合前执行，而 HAVING 可以看作拿到了聚合的结果，在聚合后执行。</p>
<p>查找 年龄大于50岁被处刑的人数大于2 的县：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> county, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> number_over_50</span><br><span class="line"><span class="keyword">FROM</span> executions</span><br><span class="line"><span class="keyword">WHERE</span> ex_age <span class="operator">&gt;</span> <span class="number">50</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> county</span><br><span class="line"><span class="keyword">HAVING</span> number_over_50 <span class="operator">&gt;</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Nest-select"><a href="#Nest-select" class="headerlink" title="Nest select"></a>Nest select</h3><p>查找遗言最长的人：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name, last_name</span><br><span class="line"><span class="keyword">FROM</span> executions</span><br><span class="line"><span class="keyword">WHERE</span> LENGTH(last_statement) <span class="operator">=</span></span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(LENGTH(last_statement))</span><br><span class="line">   <span class="keyword">FROM</span> executions)</span><br></pre></td></tr></table></figure>

<hr>
<p>查找各县被处决人数占比：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  county,</span><br><span class="line">  <span class="number">100.0</span> <span class="operator">*</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">/</span> <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> executions</span><br><span class="line">    <span class="keyword">AS</span> percentage</span><br><span class="line"><span class="keyword">FROM</span> executions</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> county</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> percentage <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<h2 id="Execution-Hiatuses"><a href="#Execution-Hiatuses" class="headerlink" title="Execution Hiatuses"></a>Execution Hiatuses</h2><p>计算经过了多少天：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> JULIANDAY(<span class="string">&#x27;1993-08-10&#x27;</span>) <span class="operator">-</span> JULIANDAY(<span class="string">&#x27;1989-07-07&#x27;</span>) <span class="keyword">AS</span> day_difference</span><br></pre></td></tr></table></figure>

<p>计算每次处决人的天数间隔：</p>
<blockquote>
<p><code>previous</code> is derived from <code>executions</code>, so we’re effectively joining <code>executions</code> to itself. This is called a “self join” and is a powerful technique for <strong>allowing rows to get information from other parts of the same table.</strong></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  last_ex_date <span class="keyword">AS</span> <span class="keyword">start</span>,</span><br><span class="line">  ex_date <span class="keyword">AS</span> <span class="keyword">end</span>,</span><br><span class="line">  <span class="comment">-- 计算天数间隔 --</span></span><br><span class="line">  JULIANDAY(ex_date) <span class="operator">-</span> JULIANDAY(last_ex_date) </span><br><span class="line">    <span class="keyword">AS</span> day_difference</span><br><span class="line"><span class="keyword">FROM</span> executions</span><br><span class="line"><span class="keyword">JOIN</span> (</span><br><span class="line">  <span class="comment">-- self join --</span></span><br><span class="line">  <span class="keyword">SELECT</span> </span><br><span class="line">    <span class="comment">-- 相邻 ex_number 间的天数间隔，因此是 ex_number + 1 --</span></span><br><span class="line">    ex_number <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> ex_number,</span><br><span class="line">    ex_date <span class="keyword">as</span> last_ex_date</span><br><span class="line">  <span class="keyword">FROM</span> executions</span><br><span class="line">  <span class="keyword">WHERE</span> ex_number <span class="operator">&lt;</span> <span class="number">553</span> </span><br><span class="line">) previous</span><br><span class="line">  <span class="keyword">ON</span> executions.ex_number <span class="operator">=</span> previous.ex_number</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> day_difference <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<p>更加优雅的写法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  previous.ex_date <span class="keyword">AS</span> <span class="keyword">start</span>,</span><br><span class="line">  executions.ex_date <span class="keyword">AS</span> <span class="keyword">end</span>,</span><br><span class="line">  JULIANDAY(executions.ex_date) <span class="operator">-</span> JULIANDAY(previous.ex_date)</span><br><span class="line">    <span class="keyword">AS</span> day_difference</span><br><span class="line"><span class="keyword">FROM</span> executions</span><br><span class="line"><span class="comment">-- alias --</span></span><br><span class="line"><span class="keyword">JOIN</span> executions previous</span><br><span class="line">  <span class="keyword">ON</span> executions.ex_number <span class="operator">=</span> previous.ex_number <span class="operator">+</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> day_difference <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<h1 id="Sql-murder-mystery"><a href="#Sql-murder-mystery" class="headerlink" title="Sql murder mystery"></a>Sql murder mystery</h1><h2 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h2><p>查找案件信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> crime_scene_report</span><br><span class="line"><span class="keyword">WHERE</span> <span class="type">date</span> <span class="operator">=</span> <span class="number">20180115</span></span><br><span class="line">  <span class="keyword">AND</span> type <span class="operator">=</span> <span class="string">&#x27;murder&#x27;</span> </span><br><span class="line">  <span class="keyword">AND</span> city <span class="operator">=</span> <span class="string">&#x27;SQL City&#x27;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>date</th>
<th>type</th>
<th>description</th>
<th>city</th>
</tr>
</thead>
<tbody><tr>
<td>20180115</td>
<td>murder</td>
<td>Security footage shows that there were 2 witnesses. The first witness lives at the last house on “Northwestern Dr”. The second witness, named Annabel, lives somewhere on “Franklin Ave”.</td>
<td>SQL City</td>
</tr>
</tbody></table>
<p>第一个目击者：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> person</span><br><span class="line"><span class="keyword">WHERE</span> address_street_name <span class="operator">=</span> <span class="string">&#x27;Northwestern Dr&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> address_number <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">1</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>license_id</th>
<th>address_number</th>
<th>address_street_name</th>
<th>ssn</th>
</tr>
</thead>
<tbody><tr>
<td>14887</td>
<td>Morty Schapiro</td>
<td>118009</td>
<td>4919</td>
<td>Northwestern Dr</td>
<td>111564949</td>
</tr>
</tbody></table>
<p>第二个目击者：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> person</span><br><span class="line"><span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%Annabel%&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> address_street_name <span class="operator">=</span> <span class="string">&#x27;Franklin Ave&#x27;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>license_id</th>
<th>address_number</th>
<th>address_street_name</th>
<th>ssn</th>
</tr>
</thead>
<tbody><tr>
<td>16371</td>
<td>Annabel Miller</td>
<td>490173</td>
<td>103</td>
<td>Franklin Ave</td>
<td>318771143</td>
</tr>
</tbody></table>
<p>拿到 id 后，可以去 interviews 中查找：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> interview</span><br><span class="line"><span class="keyword">WHERE</span> person_id <span class="operator">=</span> <span class="number">14887</span></span><br><span class="line"><span class="keyword">OR</span> person_id <span class="operator">=</span> <span class="number">16371</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>person_id</th>
<th>transcript</th>
</tr>
</thead>
<tbody><tr>
<td>14887</td>
<td>I heard a gunshot and then saw a man run out. He had a “Get Fit Now Gym” bag. The membership number on the bag started with “48Z”. Only gold members have those bags. The man got into a car with a plate that included “H42W”.</td>
</tr>
<tr>
<td>16371</td>
<td>I saw the murder happen, and I recognized the killer from my gym when I was working out last week on January the 9th.</td>
</tr>
</tbody></table>
<p>由此处信息可知，凶手有以下特征：</p>
<ul>
<li>拥有 “Get Fit Now Gym” 包，进出 Gym，并且有一次是 1 月 9 日。</li>
<li>包号码以”48Z”开头。</li>
<li>车牌号包含 “H42W”。</li>
</ul>
<p>先从 “48Z” 入手：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> get_fit_now_member</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">LIKE</span> <span class="string">&#x27;48Z%&#x27;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>id</th>
<th>person_id</th>
<th>name</th>
<th>membership_start_date</th>
<th>membership_status</th>
</tr>
</thead>
<tbody><tr>
<td>48Z38</td>
<td>49550</td>
<td>Tomas Baisley</td>
<td>20170203</td>
<td>silver</td>
</tr>
<tr>
<td>48Z7A</td>
<td>28819</td>
<td>Joe Germuska</td>
<td>20160305</td>
<td>gold</td>
</tr>
<tr>
<td>48Z55</td>
<td>67318</td>
<td>Jeremy Bowers</td>
<td>20160101</td>
<td>gold</td>
</tr>
</tbody></table>
<p>再查找车牌号：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> drivers_license</span><br><span class="line"><span class="keyword">WHERE</span> plate_number <span class="keyword">LIKE</span> <span class="string">&#x27;%H42W%&#x27;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>id</th>
<th>age</th>
<th>height</th>
<th>eye_color</th>
<th>hair_color</th>
<th>gender</th>
<th>plate_number</th>
<th>car_make</th>
<th>car_model</th>
</tr>
</thead>
<tbody><tr>
<td>183779</td>
<td>21</td>
<td>65</td>
<td>blue</td>
<td>blonde</td>
<td>female</td>
<td>H42W0X</td>
<td>Toyota</td>
<td>Prius</td>
</tr>
<tr>
<td><strong>423327</strong></td>
<td>30</td>
<td>70</td>
<td>brown</td>
<td>brown</td>
<td>male</td>
<td>0H42W2</td>
<td>Chevrolet</td>
<td>Spark LS</td>
</tr>
<tr>
<td>664760</td>
<td>21</td>
<td>71</td>
<td>black</td>
<td>black</td>
<td>male</td>
<td>4H42WR</td>
<td>Nissan</td>
<td>Altima</td>
</tr>
</tbody></table>
<p>最后看看进出日期：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> get_fit_now_check_in</span><br><span class="line"><span class="keyword">WHERE</span> check_in_date <span class="operator">=</span> <span class="number">20180109</span></span><br><span class="line"><span class="keyword">AND</span> membership_id <span class="keyword">LIKE</span> <span class="string">&#x27;48Z%&#x27;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>membership_id</th>
<th>check_in_date</th>
<th>check_in_time</th>
<th>check_out_time</th>
</tr>
</thead>
<tbody><tr>
<td>48Z7A</td>
<td>20180109</td>
<td>1600</td>
<td>1730</td>
</tr>
<tr>
<td>48Z55</td>
<td>20180109</td>
<td>1530</td>
<td>1700</td>
</tr>
</tbody></table>
<p>这样直接把凶手范围缩小到两个人了。</p>
<p>看一下这两个人的个人信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> person </span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">28819</span></span><br><span class="line"><span class="keyword">OR</span> id <span class="operator">=</span> <span class="number">67318</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>license_id</th>
<th>address_number</th>
<th>address_street_name</th>
<th>ssn</th>
</tr>
</thead>
<tbody><tr>
<td>28819</td>
<td>Joe Germuska</td>
<td>173289</td>
<td>111</td>
<td>Fisk Rd</td>
<td>138909730</td>
</tr>
<tr>
<td>67318</td>
<td>Jeremy Bowers</td>
<td><strong>423327</strong></td>
<td>530</td>
<td>Washington Pl, Apt 3A</td>
<td>871539279</td>
</tr>
</tbody></table>
<p>第二个人的 license_id 和前面对上了，说明凶手是他！</p>
<blockquote>
<p>Congrats, you found the murderer! But wait, there’s more… If you think you’re up for a challenge, try querying the interview transcript of the murderer to find the real villain behind this crime. If you feel especially confident in your SQL skills, try to complete this final step with no more than 2 queries. Use this same INSERT statement with your new suspect to check your answer.</p>
</blockquote>
<p>案件还有幕后黑手，查找凶手的 interview，挑战是使用两次以内的查询。</p>
<h2 id="第二步（多步查询）"><a href="#第二步（多步查询）" class="headerlink" title="第二步（多步查询）"></a>第二步（多步查询）</h2><p>先用笨办法查一查：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> interview</span><br><span class="line"><span class="keyword">WHERE</span> person_id <span class="operator">=</span> <span class="number">67318</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>person_id</th>
<th>transcript</th>
</tr>
</thead>
<tbody><tr>
<td>67318</td>
<td>I was hired by a woman with a lot of money. I don’t know her name but I know she’s around 5’5” (65”) or 5’7” (67”). She has red hair and she drives a Tesla Model S. I know that she attended the SQL Symphony Concert 3 times in December 2017.</td>
</tr>
</tbody></table>
<p>查找 drivers_license 表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> drivers_license</span><br><span class="line"><span class="keyword">WHERE</span> car_make <span class="operator">=</span> <span class="string">&#x27;Tesla&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> car_model <span class="operator">=</span> <span class="string">&#x27;Model S&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> hair_color <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> gender <span class="operator">=</span> <span class="string">&#x27;female&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> age <span class="operator">&gt;=</span> <span class="number">60</span></span><br><span class="line"><span class="keyword">AND</span> age <span class="operator">&lt;=</span> <span class="number">70</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>id</th>
<th>age</th>
<th>height</th>
<th>eye_color</th>
<th>hair_color</th>
<th>gender</th>
<th>plate_number</th>
<th>car_make</th>
<th>car_model</th>
</tr>
</thead>
<tbody><tr>
<td>202298</td>
<td>68</td>
<td>66</td>
<td>green</td>
<td>red</td>
<td>female</td>
<td>500123</td>
<td>Tesla</td>
<td>Model S</td>
</tr>
<tr>
<td>291182</td>
<td>65</td>
<td>66</td>
<td>blue</td>
<td>red</td>
<td>female</td>
<td>08CM64</td>
<td>Tesla</td>
<td>Model S</td>
</tr>
</tbody></table>
<p>从 license_id 得到人的 id：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;person&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> license_id <span class="operator">=</span> <span class="number">202298</span></span><br><span class="line">   <span class="keyword">OR</span> license_id <span class="operator">=</span> <span class="number">291182</span> </span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>license_id</th>
<th>address_number</th>
<th>address_street_name</th>
<th>ssn</th>
</tr>
</thead>
<tbody><tr>
<td>90700</td>
<td>Regina George</td>
<td>291182</td>
<td>332</td>
<td>Maple Ave</td>
<td>337169072</td>
</tr>
<tr>
<td>99716</td>
<td>Miranda Priestly</td>
<td>202298</td>
<td>1883</td>
<td>Golden Ave</td>
<td>987756388</td>
</tr>
</tbody></table>
<p>最后使用”参加音乐会”的条件：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> facebook_event_checkin</span><br><span class="line"><span class="keyword">WHERE</span> <span class="type">date</span> <span class="operator">&gt;=</span> <span class="number">20171201</span></span><br><span class="line">  <span class="keyword">AND</span> <span class="type">date</span> <span class="operator">&lt;=</span> <span class="number">20171231</span></span><br><span class="line">  <span class="keyword">AND</span> event_name <span class="operator">=</span> <span class="string">&#x27;SQL Symphony Concert&#x27;</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> person_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(person_id) <span class="operator">=</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>person_id</th>
<th>event_id</th>
<th>event_name</th>
<th>date</th>
</tr>
</thead>
<tbody><tr>
<td>24556</td>
<td>1143</td>
<td>SQL Symphony Concert</td>
<td>20171224</td>
</tr>
<tr>
<td>99716</td>
<td>1143</td>
<td>SQL Symphony Concert</td>
<td>20171229</td>
</tr>
</tbody></table>
<p>对比可知幕后黑手是 Miranda Priestly。</p>
<h2 id="第二步（两步查询）"><a href="#第二步（两步查询）" class="headerlink" title="第二步（两步查询）"></a>第二步（两步查询）</h2><p>先查找 interview，因为信息蕴含在他的话语中，这一步没法被合并。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> interview</span><br><span class="line"><span class="keyword">WHERE</span> person_id <span class="operator">=</span> <span class="number">67318</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>person_id</th>
<th>transcript</th>
</tr>
</thead>
<tbody><tr>
<td>67318</td>
<td>I was hired by a woman with a lot of money. I don’t know her name but I know she’s around 5’5” (65”) or 5’7” (67”). She has red hair and she drives a Tesla Model S. I know that she attended the SQL Symphony Concert 3 times in December 2017.</td>
</tr>
</tbody></table>
<p>接下来的查询用一次完成：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> drivers_license l</span><br><span class="line"><span class="comment">-- 连接写在 WHERE 前面 --</span></span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> person p	</span><br><span class="line"><span class="keyword">ON</span> p.license_id <span class="operator">=</span> l.id</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> facebook_event_checkin</span><br><span class="line">  <span class="keyword">WHERE</span> <span class="type">date</span> <span class="operator">&gt;=</span> <span class="number">20171201</span></span><br><span class="line">    <span class="keyword">AND</span> <span class="type">date</span> <span class="operator">&lt;=</span> <span class="number">20171231</span></span><br><span class="line">    <span class="keyword">AND</span> event_name <span class="operator">=</span> <span class="string">&#x27;SQL Symphony Concert&#x27;</span></span><br><span class="line">  <span class="keyword">GROUP</span> <span class="keyword">BY</span> person_id</span><br><span class="line">  <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(person_id) <span class="operator">=</span> <span class="number">3</span></span><br><span class="line">) f </span><br><span class="line"><span class="keyword">ON</span> p.id <span class="operator">=</span> f.person_id</span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> car_make <span class="operator">=</span> <span class="string">&#x27;Tesla&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> car_model <span class="operator">=</span> <span class="string">&#x27;Model S&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> hair_color <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> gender <span class="operator">=</span> <span class="string">&#x27;female&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> age <span class="operator">&gt;=</span> <span class="number">60</span></span><br><span class="line"><span class="keyword">AND</span> age <span class="operator">&lt;=</span> <span class="number">70</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>name</th>
</tr>
</thead>
<tbody><tr>
<td>Miranda Priestly</td>
</tr>
</tbody></table>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/js/">js</a><a class="post-meta__tags" href="/tags/hrbrid/">hrbrid</a></div><div class="post_share"><div class="social-share" data-image="https://z3.ax1x.com/2021/08/17/fIut8s.png" data-sites="wechat,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/10/13/jsb/"><img class="next-cover" src= "https://z3.ax1x.com/2021/08/18/fIcAZ6.gif" data-lazy-src="https://z3.ax1x.com/2021/08/17/fIut8s.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JSBridge</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/10/13/jsb/" title="JSBridge"><img class="cover" src= "https://z3.ax1x.com/2021/08/18/fIcAZ6.gif" data-lazy-src="https://z3.ax1x.com/2021/08/17/fIut8s.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-13</div><div class="title">JSBridge</div></div></a></div><div><a href="/2022/10/13/正则表达式/" title="正则表达式"><img class="cover" src= "https://z3.ax1x.com/2021/08/18/fIcAZ6.gif" data-lazy-src="https://z3.ax1x.com/2021/08/17/fIut8s.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-13</div><div class="title">正则表达式</div></div></a></div><div><a href="/2022/10/13/预加载/" title="预加载"><img class="cover" src= "https://z3.ax1x.com/2021/08/18/fIcAZ6.gif" data-lazy-src="https://z3.ax1x.com/2021/08/17/fIut8s.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-13</div><div class="title">预加载</div></div></a></div><div><a href="/2022/10/13/异步任务调度器/" title="异步任务调度器"><img class="cover" src= "https://z3.ax1x.com/2021/08/18/fIcAZ6.gif" data-lazy-src="https://z3.ax1x.com/2021/08/17/fIut8s.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-13</div><div class="title">异步任务调度器</div></div></a></div><div><a href="/2022/10/13/文件上传/" title="文件上传"><img class="cover" src= "https://z3.ax1x.com/2021/08/18/fIcAZ6.gif" data-lazy-src="https://z3.ax1x.com/2021/08/17/fIut8s.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-13</div><div class="title">文件上传</div></div></a></div><div><a href="/2021/08/22/模块化/" title="模块化"><img class="cover" src= "https://z3.ax1x.com/2021/08/18/fIcAZ6.gif" data-lazy-src="https://z3.ax1x.com/2021/08/17/fInI9s.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-22</div><div class="title">模块化</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "https://z3.ax1x.com/2021/08/18/fIcAZ6.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Danmoits</div><div class="author-info__description">HUST-CS-20</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/DanmoSAMA"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Select-Star-Sql"><span class="toc-number">1.</span> <span class="toc-text">Select Star Sql</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Beazley%E2%80%99s-Last-Statement"><span class="toc-number">1.1.</span> <span class="toc-text">Beazley’s Last Statement</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Claims-of-Innocence"><span class="toc-number">1.2.</span> <span class="toc-text">Claims of Innocence</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-long-tail"><span class="toc-number">1.3.</span> <span class="toc-text">The long tail</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Strange-Query"><span class="toc-number">1.3.1.</span> <span class="toc-text">Strange Query</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nest-select"><span class="toc-number">1.3.2.</span> <span class="toc-text">Nest select</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Execution-Hiatuses"><span class="toc-number">1.4.</span> <span class="toc-text">Execution Hiatuses</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sql-murder-mystery"><span class="toc-number">2.</span> <span class="toc-text">Sql murder mystery</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5"><span class="toc-number">2.1.</span> <span class="toc-text">第一步</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%88%E5%A4%9A%E6%AD%A5%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">第二步（多步查询）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%88%E4%B8%A4%E6%AD%A5%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="toc-number">2.3.</span> <span class="toc-text">第二步（两步查询）</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/img/index.png')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By Danmoits</div><div class="footer_custom_text"><span>天気はいから，散歩しましよ。</span><br><a href="http://beian.miit.gov.cn/"  style="color:#f72b07" target="_blank">鄂ICP备2021014938号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '38f3004c23ea76e7b591',
      clientSecret: '7f26b7a58a9d40bacc884c008e5329b6bf1365e8',
      repo: 'DanmoSAMA.github.io',
      owner: 'DanmoSAMA',
      admin: ['DanmoSAMA'],
      id: '123cf89ccc5e59b678ee126d56d5c736',
      updateCountCallback: commentCount
    },))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><link rel="stylesheet" href="https://butterfly.lete114.top/css/Lete.css"><script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script><script src="/js/custom.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='all'|| 'all' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><a class="magnet_link_more"  href="https://danmosama.github.io/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #b30070}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>function history_calendar_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>那年今日</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>';
                console.log('已挂载history_calendar')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='/'|| '/' ==='all')){

            history_calendar_injector_config()
        } </script><script data-pjax  src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script data-pjax>function electric_clock_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img id="card-clock-loading" src= "https://z3.ax1x.com/2021/08/18/fIcAZ6.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-clock/clock/images/weather/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading" class="entered loading"></div></div></div></div></div>';
                console.log('已挂载electric_clock')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='/'|| '/' ==='all')){

            electric_clock_injector_config()
        } </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax  src="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.js"></script><!-- hexo injector body_end end --></body></html>